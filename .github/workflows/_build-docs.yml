name: build-docs

on:
  workflow_call:

# For details on the macOS enviornment see https://github.com/actions/virtual-environments/blob/main/images/macos/macos-10.15-Readme.md
#
# We try to align the versions of tools with what is already available on the image to reduce the time it takes to run our CI.
# At the time of writing(October 2020) these are:
#
# Node: 12.18.4 (Set via .nvmrc)
# Bundler: 2.2.3 (Installed below)
#

defaults:
  run:
    shell: bash -l {0}

jobs:
  BuildDocs:
    name: Build Docs
    runs-on: macos-11
    needs: [Setup]
    steps:
      - name: Build and verify docs
        if: steps.extract_git_tag.outputs.GIT_TAG == '' && github.ref == 'refs/heads/main'
        run: ./scripts/build-docs-ci && rm -rf docs

      - name: Build (pull request build)
        if: steps.extract_git_tag.outputs.GIT_TAG == '' && github.ref != 'refs/heads/main'
        run: ./scripts/build-docs-ci $PR_NUMBER
        env:
          PR_NUMBER: ${{ github.event.pull_request.number }}
