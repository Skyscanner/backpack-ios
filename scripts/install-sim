#!/bin/bash

# https://github.blog/changelog/2025-07-11-upcoming-changes-to-macos-hosted-runners-macos-latest-migration-and-xcode-support-policy-updates/#xcode-support-policy-update


# https://github.com/actions/runner-images/issues/12758#issuecomment-3189512995
# Necessary to avoid random `Finding content...Unable to connect to simulator.`
export DEVELOPER_DIR="/Applications/Xcode_16.app/Contents/Developer"
sudo pkill -9 -f CoreSimulator
xcrun simctl shutdown all || true


# https://github.com/actions/runner-images/issues/551#issuecomment-2592352081


# https://github.com/actions/runner-images/blob/main/images/macos/macos-15-arm64-Readme.md#installed-sdks
sudo xcodebuild -downloadPlatform iOS


# https://github.com/actions/runner-images/blob/main/images/macos/macos-15-arm64-Readme.md#installed-simulators
xcrun simctl create "iPhone SE (3rd generation)" "com.apple.CoreSimulator.SimDeviceType.iPhone-SE-3rd-generation" "com.apple.CoreSimulator.SimRuntime.iOS-18-0"
